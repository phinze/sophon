<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>sophon — {{.Session.Project}}</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: #1a1a2e;
    color: #e0e0e0;
    min-height: 100vh;
    padding: 16px;
  }
  .container { max-width: 480px; margin: 0 auto; }
  .project {
    font-size: 14px;
    color: #8888aa;
    margin-bottom: 12px;
  }
  .context {
    background: #16213e;
    border: 1px solid #2a2a4a;
    border-radius: 8px;
    padding: 12px 16px;
    margin-bottom: 16px;
    font-family: "SF Mono", "Fira Code", monospace;
    font-size: 13px;
    line-height: 1.5;
    white-space: pre-wrap;
    word-break: break-word;
    max-height: 300px;
    overflow-y: auto;
  }
  .quick-buttons {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
  }
  .quick-buttons button {
    flex: 1;
    padding: 12px 8px;
    border: none;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.15s;
  }
  .quick-buttons button:active { opacity: 0.7; }
  .btn-allow { background: #2d6a4f; color: #fff; }
  .btn-allow-all { background: #1b4332; color: #b7e4c7; }
  .btn-deny { background: #6a2d2d; color: #fff; }
  .input-group {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
  }
  .input-group input {
    flex: 1;
    padding: 12px;
    border: 1px solid #2a2a4a;
    border-radius: 8px;
    background: #16213e;
    color: #e0e0e0;
    font-size: 15px;
    outline: none;
  }
  .input-group input:focus { border-color: #5555aa; }
  .input-group button {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    background: #3a3a6a;
    color: #fff;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
  }
  .input-group button:active { opacity: 0.7; }
  .session-state {
    font-size: 13px;
    padding: 8px 12px;
    border-radius: 8px;
    margin-bottom: 12px;
  }
  .session-state.stopped {
    background: #1a2a1a;
    color: #8aaa8a;
  }
  .meta {
    font-size: 12px;
    color: #555577;
    text-align: center;
  }
  .status {
    text-align: center;
    padding: 12px;
    margin-bottom: 16px;
    border-radius: 8px;
    font-size: 14px;
    display: none;
  }
  .status.ok { display: block; background: #1b4332; color: #b7e4c7; }
  .status.err { display: block; background: #6a2d2d; color: #ffc0c0; }
</style>
</head>
<body>
<div class="container">
  <div class="project">{{.Session.Project}}</div>

  {{if .IsStopped}}
  <div class="session-state stopped">Session complete · stopped {{timeAgo .Session.StoppedAt}}</div>
  {{end}}

  {{if .Session.NotifyMessage}}
  <div class="context">{{.Session.NotifyMessage}}</div>
  {{end}}

  <div id="status" class="status"></div>

  {{if not .IsStopped}}
    {{if .HasPerm}}
    <div class="quick-buttons">
      <button class="btn-allow" onclick="send('y')">Allow</button>
      <button class="btn-allow-all" onclick="send('a')">Always</button>
      <button class="btn-deny" onclick="send('n')">Deny</button>
    </div>
    {{end}}

    <div class="input-group">
      <input type="text" id="text" placeholder="Type a response..." autofocus
             onkeydown="if(event.key==='Enter')sendText()">
      <button onclick="sendText()">Send</button>
    </div>
  {{end}}

  <div class="meta">Session {{.Session.ID}} · {{.TimeAgo}}</div>
</div>

<script>
const apiBase = '{{.BaseURL}}';
const sessionId = '{{.Session.ID}}';

function showStatus(msg, ok) {
  const el = document.getElementById('status');
  el.textContent = msg;
  el.className = 'status ' + (ok ? 'ok' : 'err');
  if (ok) setTimeout(() => { el.className = 'status'; }, 3000);
}

function send(text) {
  fetch(apiBase + '/api/respond/' + sessionId, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({text: text})
  })
  .then(r => {
    if (r.ok) showStatus('Sent: ' + text, true);
    else r.text().then(t => showStatus('Error: ' + t, false));
  })
  .catch(e => showStatus('Network error: ' + e, false));
}

function sendText() {
  const input = document.getElementById('text');
  const text = input.value.trim();
  if (!text) return;
  send(text);
  input.value = '';
}
</script>
</body>
</html>
