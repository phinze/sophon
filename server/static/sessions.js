"use strict";(()=>{var d=window.__SOPHON__,r=d.apiBase;function s(n){let t=document.createElement("div");return t.textContent=n,t.innerHTML}function c(n){if(!n)return"just now";let t=Date.now()-new Date(n).getTime();if(t<6e4)return"just now";if(t<36e5){let e=Math.floor(t/6e4);return e===1?"1m ago":e+"m ago"}let i=Math.floor(t/36e5);return i===1?"1h ago":i+"h ago"}function f(n){let t=n.notify_message?"dot-waiting":"dot-active",i="Started "+c(n.started_at);n.last_activity_at&&(i+=" \xB7 active "+c(n.last_activity_at)),n.notify_message&&n.notified_at&&(i+=" \xB7 notified "+c(n.notified_at));let e='<a class="card" href="/respond/'+s(n.session_id)+'">';return e+='<div class="card-header">',e+='<span class="dot '+t+'"></span>',e+='<span class="project-name">'+s(n.project)+"</span>",n.node_name&&(e+='<span class="node-name">'+s(n.node_name)+"</span>"),e+="</div>",e+='<div class="card-detail">'+s(i)+"</div>",n.notify_message&&(e+='<div class="card-message">'+s(n.notify_message)+"</div>"),e+="</a>",e}function l(n){let t='<div class="card">';return t+='<div class="card-header">',t+='<span class="dot dot-stopped"></span>',t+='<span class="project-name">'+s(n.project)+"</span>",n.node_name&&(t+='<span class="node-name">'+s(n.node_name)+"</span>"),t+="</div>",t+='<div class="card-detail">Stopped '+c(n.stopped_at||"")+"</div>",t+="</div>",t}function a(){fetch(r+"/api/sessions").then(n=>n.json()).then(n=>{let t=document.getElementById("active-sessions"),i=document.getElementById("recent-sessions"),e=n.active||[];e.length>0?t.innerHTML=e.map(f).join(""):t.innerHTML='<div class="empty">No active sessions</div>';let o=n.recent||[];o.length>0?i.innerHTML=o.map(l).join(""):i.innerHTML='<div class="empty">No recent sessions</div>'}).catch(()=>{})}function p(){"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()}function v(n,t){if(!("Notification"in window)||Notification.permission!=="granted")return;let i=t.title||"sophon",e=t.message||"",o=new Notification(i,{body:e,tag:"sophon-"+n});o.onclick=()=>{window.open("/respond/"+n,"_blank"),o.close()}}function g(){let n=new EventSource(r+"/api/events");n.addEventListener("notification",t=>{let i=JSON.parse(t.data),e=i.data||{};v(i.session_id,e),a()}),n.addEventListener("session_start",()=>{a()}),n.addEventListener("session_end",()=>{a()}),n.addEventListener("activity",()=>{a()}),window.addEventListener("beforeunload",()=>{n.close()})}p();g();})();
