"use strict";(()=>{var d=window.__SOPHON__,r=d.apiBase;function s(t){let n=document.createElement("div");return n.textContent=t,n.innerHTML}function c(t){if(!t)return"just now";let n=Date.now()-new Date(t).getTime();if(n<6e4)return"just now";if(n<36e5){let e=Math.floor(n/6e4);return e===1?"1m ago":e+"m ago"}let i=Math.floor(n/36e5);return i===1?"1h ago":i+"h ago"}function f(t){let n=t.notify_message?"dot-waiting":"dot-active",i="Started "+c(t.started_at);t.last_activity_at&&(i+=" \xB7 active "+c(t.last_activity_at)),t.notify_message&&t.notified_at&&(i+=" \xB7 notified "+c(t.notified_at));let e='<a class="card" href="/respond/'+s(t.session_id)+'">';return e+='<div class="card-header">',e+='<span class="dot '+n+'"></span>',e+='<span class="project-name">'+s(t.project)+"</span>",t.node_name&&(e+='<span class="node-name">'+s(t.node_name)+"</span>"),e+="</div>",e+='<div class="card-detail">'+s(i)+"</div>",t.notify_message&&(e+='<div class="card-message">'+s(t.notify_message)+"</div>"),e+="</a>",e}function l(t){let n='<div class="card">';return n+='<div class="card-header">',n+='<span class="dot dot-stopped"></span>',n+='<span class="project-name">'+s(t.project)+"</span>",t.node_name&&(n+='<span class="node-name">'+s(t.node_name)+"</span>"),n+="</div>",n+='<div class="card-detail">Stopped '+c(t.stopped_at||"")+"</div>",n+="</div>",n}function a(){fetch(r+"/api/sessions").then(t=>t.json()).then(t=>{let n=document.getElementById("active-sessions"),i=document.getElementById("recent-sessions"),e=t.active||[];e.length>0?n.innerHTML=e.map(f).join(""):n.innerHTML='<div class="empty">No active sessions</div>';let o=t.recent||[];o.length>0?i.innerHTML=o.map(l).join(""):i.innerHTML='<div class="empty">No recent sessions</div>'}).catch(()=>{})}function p(){"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()}function v(t,n){if(!("Notification"in window)||Notification.permission!=="granted")return;let i=n.title||"sophon",e=n.message||"",o=new Notification(i,{body:e,tag:"sophon-"+t});o.onclick=()=>{window.open("/respond/"+t,"_blank"),o.close()}}function g(){let t=new EventSource(r+"/api/events");t.addEventListener("notification",n=>{let i=JSON.parse(n.data),e=i.data||{};v(i.session_id,e),a()}),t.addEventListener("session_start",()=>{a()}),t.addEventListener("session_end",()=>{a()}),t.addEventListener("activity",()=>{a()})}p();g();})();
